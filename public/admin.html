<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Admin Panel ðŸŒ´</title>
<link href="https://fonts.googleapis.com/css2?family=Linotte:wght@600&display=swap" rel="stylesheet">
<style>
body{font-family:'Linotte',sans-serif;text-align:center;background:#f0f8ff;padding:30px;}
.card{background: rgba(255,255,255,0.9);width:90%; max-width:800px;margin:30px auto;padding:20px;border-radius:20px;box-shadow:0 8px 20px rgba(0,0,0,0.2);}
input, button{padding:10px;margin:5px;border-radius:8px;width:80%;}
button{cursor:pointer;font-weight:bold;background:#ffb6b9;border:none;transition:0.2s;}
button:hover{background:#ff8b94;}
table{margin:auto;width:95%;border-collapse:collapse;}
th,td{border:1px solid #ccc;padding:8px;text-align:center;}
thead{background:#ffd700;}
.toast{position:fixed;top:20px;right:20px;background:#4CAF50;color:#fff;padding:12px 20px;border-radius:10px;box-shadow:0 5px 15px rgba(0,0,0,0.3);z-index:10000;animation:fadeinout 3s forwards;}
@keyframes fadeinout{0%{opacity:0; transform:translateY(-20px);}10%{opacity:1; transform:translateY(0);}90%{opacity:1;}100%{opacity:0; transform:translateY(-20px);}}
</style>
</head>
<body>

<div class="card">
<h2>ðŸŒ´ Admin Panel</h2>

<!-- Dodo & Password Management -->
<input id="dodoInput" placeholder="Enter new Dodo Code">
<button onclick="updateDodo()">Update Dodo Code</button><br>
<input id="islandPasswordInput" placeholder="Set Island Password">
<button onclick="updateIslandPassword()">Update Island Password</button><br>

<!-- Live Visitor Status -->
<h3>Visitor Status</h3>
<p>Currently on Island: <span id="visitorCount">0</span>/7</p>
<table>
<thead>
<tr>
<th>Player Name</th>
<th>Island Name</th>
<th>Password</th>
<th>Position</th>
<th>Status</th>
<th>Joined At</th>
<th>Time on Island</th>
</tr>
</thead>
<tbody id="visitorTable"></tbody>
</table>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let islandPassword = "daijoubu";

// Keep track of join times
let joinTimes = {};

function showToast(msg){
    const toast = document.createElement("div");
    toast.className="toast"; toast.innerText = msg;
    document.body.appendChild(toast);
    setTimeout(()=>toast.remove(),3000);
}

// Update Dodo code
function updateDodo(){
    const code = document.getElementById("dodoInput").value.trim();
    if(code){
        socket.emit("updateDodo", code);
        showToast("âœ… Dodo code successfully updated!");
    }
}

// Update Island password
function updateIslandPassword(){
    const newPass = document.getElementById("islandPasswordInput").value.trim();
    if(newPass){
        islandPassword = newPass;
        socket.emit("updateIslandPassword", newPass);
        showToast("âœ… Island password successfully updated!");
    }
}

// Live queue updates
socket.on("queueUpdate", data => {
    const tbody = document.getElementById("visitorTable");
    tbody.innerHTML = "";
    data.users.forEach(u=>{
        // Save join time if first seen
        if(!joinTimes[u.userId]) joinTimes[u.userId] = new Date();

        const joinedAt = joinTimes[u.userId];
        let timeOnIsland = "-";
        if(u.active){
            const diffMs = new Date() - joinedAt;
            const diffMins = Math.floor(diffMs/60000);
            const diffSecs = Math.floor((diffMs%60000)/1000);
            timeOnIsland = `${diffMins}m ${diffSecs}s`;
        }

        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${u.username}</td>
                        <td>${u.visitorIsland}</td>
                        <td>${u.visitorPassword}</td>
                        <td>${u.position}</td>
                        <td>${u.active ? 'On Island' : 'Waiting'}</td>
                        <td>${joinedAt.toLocaleString()}</td>
                        <td>${timeOnIsland}</td>`;
        tbody.appendChild(tr);
    });
    document.getElementById("visitorCount").innerText = data.activeCount;
});
</script>
</body>
</html>