<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ü™ªDaijoubu's Private Island Queueü™ª</title>
<style>
/* 1Ô∏è‚É£ Linotte Bold Setup */
@font-face {
  font-family: 'Linotte';
  src: url('fonts/Linotte-Bold.ttf') format('truetype');
  font-weight: bold;
  font-style: normal;
}

/* 2Ô∏è‚É£ Force entire site to use Linotte Bold */
* {
  font-family: 'Linotte', sans-serif !important;
  font-weight: bold !important;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

body {
  margin:0; padding:0;
  text-align:center;
  background:url('bg.jpg') no-repeat center center fixed;
  background-size:cover;
}

.card{
  background: rgba(255,255,255,0.9);
  width:360px;
  margin:40px auto;
  padding:25px;
  border-radius:25px;
  box-shadow:0 10px 25px rgba(0,0,0,0.2);
}

input{
  padding:10px;
  margin:8px 0;
  border-radius:10px;
  border:1px solid #ccc;
  width:85%;
}

button{
  background:#ffb6b9;
  border:none;
  padding:10px 18px;
  border-radius:12px;
  cursor:pointer;
  font-weight:bold;
}
button:hover{background:#ff8b94;}

header{
  width:100%;
  padding:15px;
  background: rgba(255,255,255,0.9);
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.progress-container{
  background: #ddd;
  border-radius: 20px;
  height: 20px;
  overflow: hidden;
  margin-top: 10px;
}
.progress-bar{
  height: 100%;
  width: 0%;
  background: green;
  transition: 0.3s;
}

.comment-box{
  text-align:left;
  max-height:200px;
  overflow-y:auto;
  margin-bottom:10px;
}
.comment-item{
  background:#f5f5f5;
  padding:8px;
  border-radius:10px;
  margin-bottom:8px;
}

#rulesModal, #aboutModal{
  display:none;
  position:fixed;
  top:0; left:0;
  width:100%; height:100%;
  background: rgba(0,0,0,0.7);
  z-index:9999;
}
#rulesModal div, #aboutModal div{
  background:#fff; padding:30px; border-radius:20px;
  margin:100px auto; width:90%; max-width:400px;
}
#rulesModal button, #aboutModal button{
  border:none; padding:12px 20px;
  border-radius:12px; background:#ffb6b9;
  cursor:pointer; font-weight:bold; transition:0.2s;
}
#rulesModal button:hover, #aboutModal button:hover{background:#ff8b94;}
#rulesModal a, #aboutModal a{color:#ff8b94; font-weight:bold; text-decoration:none;}
#rulesModal a:hover, #aboutModal a:hover{text-decoration:underline;}

footer{
  width:100%; background:#ffd700; padding:12px 0;
  display:flex; justify-content:center; gap:20px;
  box-shadow:0 -4px 10px rgba(0,0,0,0.2);
  position:fixed; bottom:0;
}
footer a{
  display:flex; align-items:center; gap:8px;
  text-decoration:none; font-weight:bold;
  color:#000; background:#fff; padding:8px 12px; border-radius:12px;
  transition:0.2s;
}
footer a:hover{background:#ffeb99;}
footer img{width:24px; height:24px;}
</style>
</head>
<body>

<header>
  <h1>üå∏Private Island Queueüå∏</h1>
  <button onclick="openAbout()">‚ÑπÔ∏è About / Island Maps</button>
</header>

<!-- Rules Modal -->
<div id="rulesModal">
    <div>
        <h2>üå¥ Welcome to My Private Island</h2>
        <ul style="text-align:left; margin:15px 0;">
            <li>Grab anything you need!</li>
            <li>Leave via AIRPORT Only</li>
            <li>Follow the queue order</li>
            <li>Click Leave Island once you leave my island!</li>
            <li>Check out my <a href="https://discord.gg/YXfmSWuKQT" target="_blank">üí¨ Discord</a> if you want to join my community</li>
            <li>For Private Treasure Islands check me on <a href="https://ko-fi.com/daijoubuxix/tiers" target="_blank">‚òï Ko-fi</a>!</li>
        </ul>
        <button onclick="closeRules()">I Understand</button>
    </div>
</div>

<div class="card" id="login">
  <h2>üå¥ Island Queue</h2>
  <input id="username" placeholder="Player Name"><br>
  <input id="visitorIsland" placeholder="Island Name"><br>
  <input id="visitorPassword" placeholder="Your Password" type="password"><br>
  <button onclick="login()">Join Island Queue</button>
  <p style="margin-top:15px;" id="visitorCountDisplay">Visitors on island: 0/7</p>
</div>

<div class="card" id="queue" style="display:none;">
  <h2 id="status"></h2>
  <p id="position"></p>

  <!-- Green/Red Progress Bar -->
  <div class="progress-container">
    <div id="progressBar" class="progress-bar"></div>
  </div>
  <p id="progressText">0/7 Visitors</p>

  <h3 id="code"></h3>
  <button id="copyBtn">üìã Copy Dodo Code</button><br>
  <button id="leaveBtn">Leave Island</button>
</div>

<!-- Guestbook Section -->
<div class="card" id="commentSection" style="display:none;">
  <h3>üå¥ Visitor Guestbook</h3>
  <div id="commentsList" class="comment-box"></div>
  <input id="commentText" placeholder="Leave a comment about your visit">
  <button onclick="submitComment()">Post</button>
</div>

<!-- Treasure Maps Section -->
<div class="card" id="mapsSection" style="display:none;">
  <h2>üó∫Ô∏è Treasure Island Maps</h2>
  <p>
    <a id="mapsLink" href="#" target="_blank" style="font-weight:bold; color:#ff8b94;">
      üå¥ View My Treasure Island Maps
    </a>
  </p>
</div>

<footer>
  <a href="https://ko-fi.com/daijoubuxix/tiers" target="_blank">
    <img src="kofi-logo.png">‚òï Private Treasure Islands
  </a>
  <a href="https://discord.gg/YXfmSWuKQT" target="_blank">
    <img src="discord-logo.png">üí¨ Join my Community
  </a>
</footer>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let userId = localStorage.getItem("queueUserId");

const imgurLink = "https://imgur.com/a/maps-BVMEz0p";
document.getElementById("mapsLink").href = imgurLink;

window.onload = () => {
  if(!localStorage.getItem("rulesSeen")){
    document.getElementById("rulesModal").style.display="block";
  }
};

function openAbout(){document.getElementById("aboutModal").style.display="block";}
function closeRules(){
  document.getElementById("rulesModal").style.display="none";
  localStorage.setItem("rulesSeen","true");
}

function showQueueUI(){
  document.getElementById("login").style.display="none";
  document.getElementById("queue").style.display="block";
  document.getElementById("mapsSection").style.display="block";
  document.getElementById("commentSection").style.display="block";
}

function login(){
  const username = document.getElementById("username").value.trim();
  const visitorIsland = document.getElementById("visitorIsland").value.trim();
  const visitorPassword = document.getElementById("visitorPassword").value.trim();
  if(!username || !visitorIsland || !visitorPassword){alert("Fill all fields"); return;}

  fetch("/login",{method:"POST",
    headers:{"Content-Type":"application/json"},
    body:JSON.stringify({username,visitorIsland,visitorPassword})})
    .then(res=>res.json()).then(data=>{
      if(data.success){
        userId = crypto.randomUUID();
        localStorage.setItem("queueUserId", userId);
        showQueueUI();
        socket.emit("joinQueue",{userId,username,visitorIsland,visitorPassword});
      } else alert("Incorrect credentials");
    });
}

// Queue update
socket.on("queueUpdate",(data)=>{
  const user = data.users.find(u=>u.userId===userId);
  if(!user) return;

  document.getElementById("position").innerText="Position: "+user.position;

  const percent = (data.activeCount/7)*100;
  const bar = document.getElementById("progressBar");
  bar.style.width = percent+"%";
  bar.style.background = data.activeCount>=7?"red":"green";
  document.getElementById("progressText").innerText=data.activeCount+"/7 Visitors";

  if(user.active){
    document.getElementById("status").innerText="üéâ You're on the island!";
    document.getElementById("code").innerText="Dodo Code: "+data.dodoCode;
  } else {
    document.getElementById("status").innerText="üåº Waiting in queue...";
    document.getElementById("code").innerText="";
  }
});

// Guestbook comments
function submitComment(){
  const comment = document.getElementById("commentText").value.trim();
  if(!comment) return alert("Write something!");
  const username = document.getElementById("username").value.trim();
  const island = document.getElementById("visitorIsland").value.trim();
  socket.emit("newComment",{userId,username,island,comment});
  document.getElementById("commentText").value="";
}

socket.on("updateComments",(comments)=>{
  const box = document.getElementById("commentsList");
  box.innerHTML="";
  comments.forEach(c=>{
    box.innerHTML+=`
      <div class="comment-item">
        <strong>${c.username}</strong> (${c.island})<br>
        ${c.comment}
      </div>`;
  });
});

// Copy Dodo code
document.getElementById("copyBtn").onclick=()=>{
  const code=document.getElementById("code").innerText.replace("Dodo Code: ","");
  if(code) navigator.clipboard.writeText(code).then(()=>alert("Copied: "+code));
};

// Leave island
document.getElementById("leaveBtn").onclick=()=>{
  socket.emit("leaveIsland",userId);
  localStorage.removeItem("queueUserId");
  location.reload();
};
</script>
</body>
</html>