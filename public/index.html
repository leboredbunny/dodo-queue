<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Island Queue ðŸŒ´</title>
<link href="https://fonts.googleapis.com/css2?family=Linotte:wght@600&display=swap" rel="stylesheet">
<style>
body { font-family:'Linotte',sans-serif; margin:0; padding:0; text-align:center; background:url('bg.jpg') no-repeat center center fixed; background-size:cover;}
.card { background: rgba(255,255,255,0.85); width:360px; margin:60px auto; padding:30px; border-radius:25px; box-shadow:0 10px 25px rgba(0,0,0,0.2);}
button { background:#ffb6b9; border:none; padding:12px 22px; border-radius:12px; cursor:pointer; font-weight:bold; margin-top:10px; transition:0.2s;}
button:hover{background:#ff8b94;}
input {padding:10px; margin:8px 0; border-radius:10px; border:1px solid #ccc; width:80%; box-sizing:border-box;}
@media(max-width:500px){.card{width:90%; margin:40px auto; padding:20px;}}
</style>
</head>
<body>

<!-- Login Card -->
<div class="card" id="login">
    <h2>ðŸŒ´ Island Queue</h2>
    <input id="username" placeholder="Player Name"><br>
    <input id="visitorIsland" placeholder="Island Name"><br>
    <input id="visitorPassword" placeholder="Your Password" type="password"><br>
    <button onclick="login()">Join Queue</button>
</div>

<!-- Queue Card -->
<div class="card" id="queue" style="display:none;">
    <h2 id="status"></h2>
    <p id="position"></p>
    <p id="waitTime"></p>
    <p id="islandCount"></p>
    <h3 id="code"></h3>
    <button id="copyBtn">ðŸ“‹ Copy Dodo Code</button><br>
    <button id="leaveBtn">Leave Island</button>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
const socket = io();
let userId;

function login() {
    const username = document.getElementById("username").value.trim();
    const visitorIsland = document.getElementById("visitorIsland").value.trim();
    const visitorPassword = document.getElementById("visitorPassword").value.trim();

    if(!username || !visitorIsland || !visitorPassword){
        alert("Please fill all fields");
        return;
    }

    fetch("/login",{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body: JSON.stringify({username, visitorIsland, visitorPassword})
    })
    .then(res=>res.json())
    .then(data=>{
        if(data.success){
            userId = crypto.randomUUID();
            document.getElementById("login").style.display="none";
            document.getElementById("queue").style.display="block";
            socket.emit("joinQueue",{userId, username, visitorIsland, visitorPassword});
        } else {
            alert("Incorrect credentials! Make sure all fields are correct.");
        }
    });
}

// Queue updates
socket.on("queueUpdate",(data)=>{
    const user = data.users.find(u=>u.userId === userId);
    document.getElementById("position").innerText = user ? "Position: " + user.position : "";
    document.getElementById("waitTime").innerText = user && user.position > 7 ? "Estimated wait: "+ ((user.position-7)*5) +" min" : "";
    document.getElementById("islandCount").innerText = "Island: "+ data.activeCount +"/7 visitors";

    if(user && user.active){
        document.getElementById("status").innerText = "ðŸŽ‰ You're on the island!";
        document.getElementById("code").innerText = "Dodo Code: "+ data.dodoCode;
    } else {
        document.getElementById("status").innerText = "ðŸŒ¼ Waiting in queue...";
        document.getElementById("code").innerText = "";
    }
});

document.getElementById("leaveBtn").onclick = ()=>{ socket.emit("leaveIsland",userId); };
document.getElementById("copyBtn").onclick = ()=>{
    const code = document.getElementById("code").innerText.replace("Dodo Code: ","");
    if(code) navigator.clipboard.writeText(code).then(()=>alert("Copied: "+code));
};
</script>
</body>
</html>